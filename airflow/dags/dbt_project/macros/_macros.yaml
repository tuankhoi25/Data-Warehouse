version: 2

macros:
  - name: generate_schema_name
    description: >
      Đây là một macro mặc định của dbt được ghi đè (override) để thay đổi cách đặt tên schema.
      Thay vì chỉ dùng custom_schema, nó sẽ nối thêm schema của target hiện tại vào trước.
      Ví dụ: Nếu target schema là 'dev' và custom schema là 'sales', kết quả sẽ là 'dev_sales'.
    arguments:
      - name: custom_schema_name
        type: string
        description: "Tên schema tùy chỉnh được định nghĩa trong cấu hình model (config schema)."
      - name: node
        type: object
        description: "Đối tượng node của dbt đại diện cho model đang được biên dịch."

  - name: get_current_ingestion_ts
    description: >
      Macro này giúp lấy biến logical_date được truyền từ dbt run --var, cast thành datetime.
      Đặc biệt dùng để nhận logical_date từ mỗi lần job chạy trên airflow

  - name: is_exists
    description: >
      Kiểm tra xem một relation trong database (table, view, materialized view, ...)
      đã tồn tại hay chưa bằng cách sử dụng adapter.get_relation.
      Macro trả về true nếu relation tồn tại, ngược lại trả về false.
    arguments:
      - name: database
        type: string
        description: >
          Tên database (hoặc catalog) chứa relation cần kiểm tra.
      - name: schema
        type: string
        description: >
          Tên schema của relation.
          Với các warehouse không hỗ trợ schema (ví dụ ClickHouse),
          giá trị này thường trùng với database.
      - name: identifier
        type: string
        description: >
          Tên của relation (table hoặc view).
