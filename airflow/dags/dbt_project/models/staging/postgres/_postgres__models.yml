version: 2

models:
  - name: stg_postgres__customers
    description: "Staging chuẩn hoá dữ liệu khách hàng: map null và cast kiểu."
    columns:
      - name: customer_id
        data_type: UInt64
        description: "Khóa chính khách hàng (từ source `customer.id`)."
      - name: customer_name
        data_type: String
        description: "Tên khách hàng; null được thay bằng 'Unknown'."
      - name: sex
        data_type: Int8
        description: "Giới tính mã hoá (1=male,2=female,3=other)."
      - name: mail
        data_type: String
        description: "Email khách hàng; null được thay bằng giá trị mặc định."
      - name: birth_date
        data_type: Date
        description: "Ngày sinh khách hàng; null được thay bằng giá trị mặc định."
      - name: signup_date
        data_type: Date
        description: "Thời điểm tạo tài khoản (từ source `created_at`)."

  - name: stg_postgres__locations
    description: "Staging chuẩn hoá thông tin địa điểm từ source `location`."
    columns:
      - name: location_id
        data_type: UUID
        description: "Khóa chính địa điểm (từ source `location.id`)."
      - name: street_address
        data_type: String
        description: "Địa chỉ đường; null -> 'Unknown'."
      - name: city
        data_type: LowCardinality(String)
        description: "Thành phố; null -> 'Unknown'."
      - name: state
        data_type: LowCardinality(String)
        description: "Tiểu bang / tỉnh; null -> 'Unknown'."
      - name: zipcode
        data_type: FixedString(6)
        description: "Mã bưu điện, pad về chuỗi 6 ký tự."
      - name: country
        data_type: String
        description: "Quốc gia; null -> 'Unknown'."
      - name: source_updated_at
        data_type: Date
        description: "Trường `updated_at` nguồn đã được cast về Date trong staging."

  - name: stg_postgres__customer_locations
    description: "Staging liên kết khách hàng - địa điểm từ source `customer_location`."
    columns:
      - name: customer_location_id
        data_type: UInt64
        description: "Khóa chính bảng liên kết (từ source `id`)."
      - name: customer_id
        data_type: Int64
        description: "Khóa ngoại tham chiếu khách hàng."
      - name: location_id
        data_type: UUID
        description: "Khóa ngoại tham chiếu địa điểm."
      - name: source_created_at
        data_type: Date
        description: "Thời điểm tạo bản ghi nguồn."
      - name: source_updated_at
        data_type: Date
        description: "Thời điểm cập nhật bản ghi nguồn (đã cast sang Date)."

  - name: stg_postgres__products
    description: "Staging dữ liệu sản phẩm từ `shadow_product` (snapshot)."
    columns:
      - name: product_id
        data_type: String
        description: "ID sản phẩm (từ `shadow_product.product_id`)."
      - name: product_title
        data_type: String
        description: "Tiêu đề hiển thị sản phẩm."
      - name: currency
        data_type: String
        description: "Đơn vị tiền tệ của giá sản phẩm."
      - name: price
        data_type: Decimal(10, 2)
        description: "Giá sản phẩm tại thời điểm snapshot."
      - name: source_created_at
        data_type: Date
        description: "Thời điểm tạo bản ghi nguồn."
      - name: source_updated_at
        data_type: Date
        description: "Thời điểm cập nhật bản ghi nguồn (đã cast sang Date)."

  - name: stg_postgres__categories
    description: "Staging danh mục; chuẩn hoá tên theo danh sách whitelist."
    columns:
      - name: category_id
        data_type: UInt64
        description: "Khóa chính danh mục (từ source `id`)."
      - name: category_name
        data_type: String
        description: "Tên danh mục đã chuẩn hoá; không hợp lệ -> 'Other'."

  - name: stg_postgres__product_categories
    description: "Staging liên kết sản phẩm - danh mục từ source `product_category`."
    columns:
      - name: product_category_id
        data_type: UInt64
        description: "Khóa chính bảng liên kết (từ source `id`)."
      - name: product_id
        data_type: String
        description: "ID sản phẩm liên kết."
      - name: category_id
        data_type: Int64
        description: "ID danh mục liên kết."

  - name: stg_postgres__reviews
    description: "Staging dữ liệu đánh giá: cast kiểu, fill default và chuẩn hoá cờ verified."
    columns:
      - name: review_id
        data_type: String
        description: "Khóa chính đánh giá (từ source `id`)."
      - name: customer_id
        data_type: Int64
        description: "Khóa ngoại khách hàng đã đánh giá."
      - name: product_id
        data_type: String
        description: "Khóa tham chiếu sản phẩm."
      - name: star_rating
        data_type: Int8
        description: "Điểm sao (1-5)."
      - name: helpful_votes
        data_type: Int32
        description: "Số lượt được đánh dấu hữu ích; null -> 0."
      - name: total_votes
        data_type: Int32
        description: "Tổng số lượt bình chọn; null -> 0."
      - name: marketplace
        data_type: LowCardinality(FixedString(2))
        description: "Mã marketplace (ví dụ 'US'); null -> 'Un'."
      - name: verified_purchase
        data_type: Bool
        description: "Cờ đã mua thực sự (cast từ nhiều biểu diễn text)."
      - name: review_headline
        data_type: String
        description: "Tiêu đề review; null -> 'Unknown'."
      - name: review_body
        data_type: String
        description: "Nội dung review; null -> 'Unknown'."
      - name: source_created_at
        data_type: Date
        description: "Thời điểm tạo bản ghi nguồn."
      - name: source_updated_at
        data_type: Date
        description: "Thời điểm cập nhật bản ghi nguồn (đã cast sang Date)."